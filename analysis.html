<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Lab | Nobility Chess Academy</title>
    
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <style>
        :root {
            --navy: #001f3f;
            --wine: #722f37;
            --yellow: #FFD700;
            --white: #ffffff;
            --sky-blue: #e3f2fd;
            --grass-green: #4caf50;
        }

        body {
            font-family: 'Trebuchet MS', sans-serif;
            margin: 0;
            background-color: var(--sky-blue);
            color: #333;
        }

        header {
            background: linear-gradient(to right, var(--navy), var(--wine));
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-bottom: 8px solid var(--yellow);
        }

        nav { background: var(--wine); padding: 12px; text-align: center; }
        nav a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; padding: 5px 10px; border-radius: 5px; }
        nav a:hover { background: var(--yellow); color: var(--navy); }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        @media (min-width: 900px) {
            .main-container { flex-direction: row; align-items: flex-start; justify-content: center; }
        }

        /* Evaluation Bar */
        .eval-container {
            width: 30px;
            height: 450px;
            background: #444; /* Black advantage color */
            border: 4px solid var(--navy);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            display: none; /* Hidden on very small screens */
        }
        @media (min-width: 600px) { .eval-container { display: block; } }

        #eval-fill {
            width: 100%;
            height: 50%;
            background: white; /* White advantage color */
            position: absolute;
            bottom: 0;
            transition: height 0.6s ease-in-out;
        }

        /* Board Area */
        #board-wrapper {
            width: 100%;
            max-width: 450px;
        }

        #myBoard {
            width: 100%;
            border: 6px solid var(--navy);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Info Panel */
        .info-panel {
            flex: 1;
            width: 100%;
            max-width: 400px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid var(--navy);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .advice-box {
            background: #fff9c4;
            padding: 15px;
            border-radius: 15px;
            border-left: 6px solid var(--grass-green);
            margin-bottom: 20px;
        }

        .pgn-box {
            height: 120px;
            overflow-y: auto;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            border: 1px solid #ccc;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-action {
            background: var(--navy);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px var(--wine);
        }

        .btn-action:active { transform: translateY(2px); box-shadow: 0 2px var(--wine); }

        .challenge-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 8px;
            border: 2px solid #ddd;
            box-sizing: border-box;
        }

        footer { text-align: center; padding: 30px; color: var(--navy); font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>Noble Analysis Lab</h1>
    <p>Test your plans & find the winning move!</p>
</header>

<nav>
    <a href="index.html">üè† Home</a>
    <a href="classroom.html">üè´ Classroom</a>
    <a href="assessment.html">üìù Assessments</a>
</nav>

<div class="main-container">
    <div class="eval-container">
        <div id="eval-fill"></div>
    </div>

    <div id="board-wrapper">
        <div id="myBoard"></div>
        <div class="controls">
            <button class="btn-action" onclick="resetBoard()">üîÑ New Game</button>
            <button class="btn-action" onclick="undoMove()">‚¨ÖÔ∏è Undo</button>
            <button class="btn-action" onclick="board.flip()">üîÉ Flip</button>
        </div>
    </div>

    <div class="info-panel">
        <div class="advice-box">
            <h3 style="margin:0 0 10px 0;">üß† Engine Insight</h3>
            <p id="status-text">White to move. Good luck!</p>
            <p id="meter-text" style="font-weight:bold; color:var(--wine);"></p>
        </div>

        <h4>üìú Move List (PGN)</h4>
        <div id="pgn-display" class="pgn-box"></div>

        <h4>üîë Load Challenge Code</h4>
        <input type="text" id="fen-input" class="challenge-input" placeholder="Paste FEN code here...">
        <button class="btn-action" style="width:100%; margin-top:10px;" onclick="loadFEN()">Unlock Challenge</button>
    </div>
</div>

<footer>
    &copy; 2026 Nobility Chess Academy | Instructor: Mr. Adekunle Busayo
</footer>

<script>
    var board = null;
    var game = new Chess();
    var $status = $('#status-text');
    var $pgn = $('#pgn-display');
    var $meter = $('#meter-text');

    function onDragStart (source, piece, position, orientation) {
        if (game.game_over()) return false;
        if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
            (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
            return false;
        }
    }

    function onDrop (source, target) {
        var move = game.move({
            from: source,
            to: target,
            promotion: 'q' 
        });

        if (move === null) return 'snapback';

        updatePage();
    }

    function onSnapEnd () {
        board.position(game.fen());
    }

    function updatePage() {
        var status = '';
        var moveColor = (game.turn() === 'b') ? 'Black' : 'White';

        if (game.in_checkmate()) {
            status = 'Checkmate! ' + moveColor + ' loses.';
        } else if (game.in_draw()) {
            status = 'Draw! The game is a tie.';
        } else {
            status = moveColor + ' to move';
            if (game.in_check()) status += ' (In Check!)';
        }

        $status.text(status);
        $pgn.text(game.pgn());
        calculateAdvantage();
    }

    function calculateAdvantage() {
        var weights = { p: 1, n: 3, b: 3, r: 5, q: 9, k: 0 };
        var score = 0;
        
        game.board().forEach(row => {
            row.forEach(piece => {
                if (piece) {
                    var val = weights[piece.type];
                    score += (piece.color === 'w') ? val : -val;
                }
            });
        });

        // Update the visual Eval Bar
        var barHeight = 50 + (score * 4); // 1 pawn = 4% shift
        if (barHeight > 95) barHeight = 95;
        if (barHeight < 5) barHeight = 5;
        $('#eval-fill').css('height', barHeight + '%');

        // Text Advice
        if (score > 3) $meter.text("White is winning! üèÜ");
        else if (score < -3) $meter.text("Black is winning! üèÜ");
        else $meter.text("The game is equal! ‚öñÔ∏è");
    }

    function resetBoard() {
        game.reset();
        board.start();
        updatePage();
    }

    function undoMove() {
        game.undo();
        board.position(game.fen());
        updatePage();
    }

    function loadFEN() {
        var fString = $('#fen-input').val();
        if (game.load(fString)) {
            board.position(fString);
            updatePage();
        } else {
            alert("Oops! That code isn't working. Try copying it again.");
        }
    }

    var config = {
        draggable: true,
        position: 'start',
        onDragStart: onDragStart,
        onDrop: onDrop,
        onSnapEnd: onSnapEnd,
        pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    };
    board = Chessboard('myBoard', config);

    $(window).resize(board.resize);
    updatePage();
</script>

</body>
</html>
