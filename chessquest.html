<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Busayo's Academy</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    
    <style>
        body { background-color: #4a0404; color: #ffd700; font-family: 'Georgia', serif; display: flex; flex-direction: column; align-items: center; padding: 5px; margin: 0; min-height: 100vh; }
        h2 { margin: 15px 0; color: #ffd700; text-shadow: 2px 2px 4px #000; text-align: center; }
        .white-1e1d7 { background-color: #ffffff !important; } 
        .black-3c85d { background-color: #4ca154 !important; } 
        #myBoard { width: 95vw !important; max-width: 450px; border: 6px solid #ffd700; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .ui-panel { width: 95%; max-width: 450px; background: #ffd700; color: #4a0404; border: 2px solid #ffffff; padding: 15px; border-radius: 8px; box-sizing: border-box; margin-top: 10px; }
        .tutor-bubble { background: #4a0404; color: #ffd700; padding: 12px; border-radius: 6px; font-weight: bold; border-left: 5px solid #ffffff; min-height: 60px; line-height: 1.4; display: flex; align-items: center; }
        .controls { display: flex; width: 95%; max-width: 450px; gap: 8px; margin: 10px 0; }
        button { flex: 1; background: #ffd700; border: 2px solid #ffffff; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 6px; color: #4a0404; }
    </style>
</head>
<body>

    <h2>Tutor Busayo's Royal Academy</h2>
    <div id="myBoard"></div>
    <div class="controls">
        <button onclick="undoMove()">Undo Move</button>
        <button onclick="location.reload()" style="background: #ffffff;">Reset Board</button>
    </div>
    <div class="ui-panel">
        <div id="tutor-comment" class="tutor-bubble">"Welcome, student. Let the 64 squares teach you life."</div>
    </div>

<script>
var board = null;
var game = new Chess();
var sourceSquare = null;

const REMARKS = {
    opening: [
        "The opening is about harmony, not just moving pieces.",
        "Don't move the same piece twice in the opening.",
        "A Knight on the rim is dim. Keep them central!",
        "Control the center, control the world.",
        "Development is a race. Are you winning it?",
        "Your King is crying for a castle. Listen to him.",
        "Connect your rooks; let them talk to each other.",
        "A pawn is the most humble, yet most important piece.",
        "Don't bring your Queen out too early, she'll be chased.",
        "Scholar's Mate only works on those who don't focus."
    ],
    tactical: [
        "Tactics is knowing what to do when there is something to do.",
        "Every move creates a weakness. Find mine.",
        "Before you move, look at what my piece is now doing.",
        "A pin is mightier than a sword.",
        "Double attacks are the shortest path to victory.",
        "Always check, it might be mate!",
        "An undefended piece is a gift to your opponent.",
        "Capture with the right piece. Think about the recapture.",
        "Threats are often stronger than the execution.",
        "When you see a good move, look for a better one."
    ],
    safety: [
        "Is your King safe, or just lucky?",
        "A castle-less King is a target in the woods.",
        "You ignored my threat. That is a dangerous habit.",
        "Protect your warriors, and they will protect you.",
        "Space is the breath of your army.",
        "Don't trade your active pieces for my lazy ones.",
        "A bad plan is better than no plan at all.",
        "Eyes on the whole board, not just your attack.",
        "Your Queen is lonely. Support her!",
        "Patience is the greatest weapon in chess."
    ],
    general: [
        "Chess is mental torture, but beautiful.",
        "Even a Grandmaster was once a beginner.",
        "The board is a mirror of your mind.",
        "Victory goes to the one who makes the second to last mistake.",
        "Play the board, not the person.",
        "Analyze your losses more than your wins.",
        "The hardest game to win is a won game.",
        "Strategy is for the long term; tactics is for now.",
        "Every pawn is a potential Queen.",
        "Respect the board, and the board will respect you."
    ]
};

const PIECE_VALUES = { p: 10, n: 30, b: 35, r: 50, q: 90, k: 900 };

function evaluateBoard(current_game) {
    let totalEvaluation = 0;
    const board = current_game.board();
    for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
            let piece = board[i][j];
            if (piece) {
                let val = PIECE_VALUES[piece.type];
                totalEvaluation += (piece.color === 'w' ? val : -val);
            }
        }
    }
    return totalEvaluation;
}

function getBestMove() {
    let moves = game.moves();
    let bestMove = null;
    let bestValue = 9999; 

    for (let move of moves) {
        game.move(move);
        let replies = game.moves();
        let worstReply = -9999;
        for (let reply of replies) {
            game.move(reply);
            let val = evaluateBoard(game);
            if (val > worstReply) worstReply = val;
            game.undo();
        }
        game.undo();
        if (worstReply < bestValue) {
            bestValue = worstReply;
            bestMove = move;
        }
    }
    return bestMove;
}

function makeMove() {
    let moveStr = getBestMove();
    if (!moveStr) return;
    
    let moveObj = game.move(moveStr);
    board.position(game.fen());
    
    // Select Remark Category
    let moveCount = Math.floor(game.history().length / 2);
    let category = "general";
    if (moveCount < 8) category = "opening";
    else if (moveObj.captured || moveStr.includes('+')) category = "tactical";
    else if (!game.history().some(m => m.includes('O-O')) && moveCount > 10) category = "safety";
    
    let pool = REMARKS[category];
    let remark = pool[Math.floor(Math.random() * pool.length)];
    
    // Override with Castling discipline
    if (moveCount >= 12 && !game.history().some(m => m.includes('O-O'))) {
        remark = "STUDENT! You have not castled! Your King is in grave danger!";
    }

    $('#tutor-comment').text('"' + remark + '"');
}

function onSquareClick(square) {
    if (game.turn() === 'b') return;
    if (sourceSquare === null) {
        let piece = game.get(square);
        if (piece && piece.color === 'w') {
            sourceSquare = square;
            $('.square-' + square).css('box-shadow', 'inset 0 0 10px 5px #4a0404');
        }
    } else {
        var move = game.move({ from: sourceSquare, to: square, promotion: 'q' });
        if (move) {
            board.position(game.fen());
            sourceSquare = null;
            setTimeout(makeMove, 500);
        } else {
            sourceSquare = null;
            board.position(game.fen());
        }
    }
}

function undoMove() { game.undo(); game.undo(); board.position(game.fen()); }
function pieceTheme(piece) { return 'https://chessboardjs.com/img/chesspieces/wikipedia/' + piece + '.png'; }

board = Chessboard('myBoard', { position: 'start', draggable: false, pieceTheme: pieceTheme });
$(window).resize(board.resize);
$('#myBoard').on('click', '.square-55d63', function() { onSquareClick($(this).attr('data-square')); });
</script>
</body>
</html>
