<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Busayo's Academy</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    
    <style>
        /* THEME: Wine and Yellow */
        body { 
            background-color: #4a0404; /* Wine Background */
            color: #ffd700; /* Yellow Text */
            font-family: 'Georgia', serif; 
            display: flex; flex-direction: column; align-items: center; padding: 5px; margin: 0; 
        }
        
        h2 { margin: 15px 0; color: #ffd700; text-shadow: 2px 2px 4px #000; }

        /* Board Squares */
        .white-1e1d7 { background-color: #ffd700 !important; } /* Yellow Squares */
        .black-3c85d { background-color: #720b0b !important; } /* Wine Squares */
        
        #myBoard { 
            width: 95vw !important; max-width: 450px; 
            border: 5px solid #ffd700; border-radius: 4px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .ui-panel { 
            width: 95%; max-width: 450px; 
            background: #ffd700; /* Yellow Panel */
            color: #4a0404; /* Wine Text */
            border: 2px solid #ffffff; padding: 15px; 
            border-radius: 8px; box-sizing: border-box; margin-top: 10px; 
        }

        .tutor-bubble { 
            background: #4a0404; /* Wine Bubble */
            color: #ffd700; /* Yellow Text */
            padding: 12px; border-radius: 6px; 
            font-weight: bold; border-left: 5px solid #ffffff; 
            min-height: 50px; line-height: 1.4;
        }

        .controls { display: flex; width: 95%; max-width: 450px; gap: 8px; margin: 10px 0; }
        
        button { 
            flex: 1; background: #ffd700; border: 2px solid #ffffff; 
            padding: 15px; cursor: pointer; font-weight: bold; 
            border-radius: 6px; color: #4a0404; transition: 0.2s; 
        }
        
        button:active { background: #ffffff; transform: scale(0.98); }
    </style>
</head>
<body>

    <h2>Tutor Busayo's Royal Academy</h2>
    
    <div id="myBoard"></div>

    <div class="controls">
        <button onclick="undoMove()">Undo Move</button>
        <button onclick="location.reload()" style="background: #ffffff;">Reset Lesson</button>
    </div>

    <div class="ui-panel">
        <div id="tutor-comment" class="tutor-bubble">"Welcome to the Royal Academy. Protect your King, for the wine is deep and the board is unforgiving."</div>
    </div>

<script>
var board = null;
var game = new Chess();
var sourceSquare = null;

const PIECE_VALUES = { p: 10, n: 30, b: 35, r: 50, q: 90, k: 900 };

// Positional bonuses to improve AI strength
const boardWeights = {
    p: [ [0,0,0,0,0,0,0,0], [50,50,50,50,50,50,50,50], [10,10,20,30,30,20,10,10], [5,5,10,25,25,10,5,5], [0,0,0,20,20,0,0,0], [5,-5,-10,0,0,-10,-5,5], [5,10,10,-20,-20,10,10,5], [0,0,0,0,0,0,0,0] ],
    n: [ [-50,-40,-30,-30,-30,-30,-40,-50], [-40,-20,0,0,0,0,-20,-40], [-30,0,10,15,15,10,0,-30], [-30,5,15,20,20,15,5,-30], [-30,0,15,20,20,15,0,-30], [-30,5,10,15,15,10,5,-30], [-40,-20,0,5,5,0,-20,-40], [-50,-40,-30,-30,-30,-30,-40,-50] ]
};

function evaluateBoard(current_game) {
    let totalEvaluation = 0;
    const board = current_game.board();
    for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
            totalEvaluation += getPieceValue(board[i][j], i, j);
        }
    }
    return totalEvaluation;
}

function getPieceValue(piece, x, y) {
    if (piece === null) return 0;
    let val = PIECE_VALUES[piece.type];
    if (boardWeights[piece.type]) {
        val += (piece.color === 'w' ? boardWeights[piece.type][x][y] : boardWeights[piece.type][7-x][y]);
    }
    return piece.color === 'w' ? val : -val;
}

function getBestMove() {
    let moves = game.moves();
    let bestMove = null;
    let bestValue = 9999; 

    for (let move of moves) {
        game.move(move);
        let replies = game.moves();
        let worstReply = -9999;
        for (let reply of replies) {
            game.move(reply);
            let replyValue = evaluateBoard(game);
            if (replyValue > worstReply) worstReply = replyValue;
            game.undo();
        }
        game.undo();
        if (worstReply < bestValue) {
            bestValue = worstReply;
            bestMove = move;
        }
    }
    return bestMove;
}

function makeMove() {
    let move = getBestMove();
    if (!move) return;
    game.move(move);
    board.position(game.fen());
    
    let msg = "A calculated response. Do you see the threat?";
    if (move.includes('O-O')) msg = "I have castled. My King is safe in the royal palace.";
    if (move.includes('x')) msg = "A capture in the center. The value of your piece has been accounted for.";
    
    $('#tutor-comment').text('"' + msg + '"');
}

function onSquareClick(square) {
    if (game.turn() === 'b') return;
    if (sourceSquare === null) {
        let piece = game.get(square);
        if (piece && piece.color === 'w') {
            sourceSquare = square;
            $('.square-' + square).css('box-shadow', 'inset 0 0 10px 5px #4a0404');
        }
    } else {
        var move = game.move({ from: sourceSquare, to: square, promotion: 'q' });
        if (move) {
            board.position(game.fen());
            sourceSquare = null;
            setTimeout(makeMove, 500);
        } else {
            sourceSquare = null;
            board.position(game.fen());
        }
    }
}

function undoMove() { game.undo(); game.undo(); board.position(game.fen()); }
function pieceTheme(piece) { return 'https://chessboardjs.com/img/chesspieces/wikipedia/' + piece + '.png'; }

board = Chessboard('myBoard', { position: 'start', draggable: false, pieceTheme: pieceTheme });
$(window).resize(board.resize);
$('#myBoard').on('click', '.square-55d63', function() { onSquareClick($(this).attr('data-square')); });
</script>
</body>
</html>
