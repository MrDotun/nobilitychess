<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Busayo's Academy</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    
    <style>
        body { 
            background-color: #f0f4f0; color: #1a331a; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            display: flex; flex-direction: column; align-items: center; padding: 5px; margin: 0;
            overflow-x: hidden;
        }
        h1 { font-size: 1.4rem; color: #2e4a31; margin: 10px 0; }
        
        /* Board Colors */
        .white-1e1d7 { background-color: #fdfdfd !important; } 
        .black-3c85d { background-color: #4ca154 !important; } 
        
        .master-layout { 
            display: flex; flex-direction: column; align-items: center; 
            width: 100%; gap: 10px; 
        }

        /* Board covers 90% of screen width on mobile */
        #myBoard { 
            width: 90vw !important; 
            max-width: 480px; 
            border: 4px solid #2e4a31; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        
        .ui-panel { 
            width: 90%; background: #ffffff; 
            border: 1px solid #c8d8c8; padding: 12px; border-radius: 8px; 
            box-sizing: border-box;
        }

        #moveLogContainer { height: 140px; overflow-y: auto; }
        .tutor-bubble { background: #2e4a31; color: #ffffff; padding: 10px; border-radius: 6px; margin-bottom: 8px; font-weight: bold; font-size: 0.85rem; }

        .trophy-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.75rem; font-weight: bold; }
        .trophy { opacity: 0.2; display: flex; align-items: center; }
        .trophy.unlocked { opacity: 1; color: #2e4a31; }
        
        .controls { display: flex; justify-content: center; width: 90%; gap: 8px; margin: 10px 0; }
        button { flex: 1; background: #2e4a31; border: none; padding: 14px; cursor: pointer; font-weight: bold; border-radius: 6px; color: #ffffff; }
        button:active { background: #4ca154; transform: scale(0.98); }

        @media (min-width: 800px) {
            .master-layout { flex-direction: row; max-width: 1000px; padding-top: 20px; }
            #myBoard { width: 450px !important; }
            .ui-panel { width: 260px; height: 450px; }
        }
    </style>
</head>
<body>

    <h1>Tutor Busayo's Academy</h1>
    
    <div class="master-layout">
        <div class="ui-panel">
            <h3 style="margin-top:0; text-align:center;">üèÜ Achievements</h3>
            <div class="trophy-grid">
                <div id="t-castle" class="trophy">üè∞ Castle</div>
                <div id="t-capture" class="trophy">‚öîÔ∏è Capture</div>
                <div id="t-win" class="trophy">üëë Victory</div>
                <div id="t-center" class="trophy">üéØ Center</div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
            <p style="text-align:center; font-size:0.8rem; margin:0;">Best Accuracy: <span id="highScore">0</span>%</p>
        </div>

        <div>
            <div id="myBoard"></div>
            <div class="controls">
                <button onclick="undoMove()">Undo</button>
                <button onclick="evaluatePerformance()" style="background: #4ca154;">Grade</button>
            </div>
        </div>

        <div id="moveLogContainer" class="ui-panel">
            <div id="tutor-comment" class="tutor-bubble">"Ready for your lessons, student? Make your first move."</div>
            <div id="moveLog" style="font-size: 0.8rem; line-height: 1.4;"></div>
        </div>
    </div>

<script>
var board = null;
var game = new Chess();
var sourceSquare = null;
var stats = JSON.parse(localStorage.getItem('busayoStats')) || { high: 0, castle: false, capture: false, win: false, center: false };

// PIECE LOADING FIX: Direct link to Wikipedia theme
function pieceTheme(piece) {
    return 'https://chessboardjs.com/img/chesspieces/wikipedia/' + piece + '.png';
}

function updateTrophies() {
    if (stats.castle) document.getElementById('t-castle').classList.add('unlocked');
    if (stats.capture) document.getElementById('t-capture').classList.add('unlocked');
    if (stats.win) document.getElementById('t-win').classList.add('unlocked');
    if (stats.center) document.getElementById('t-center').classList.add('unlocked');
    document.getElementById('highScore').innerText = stats.high;
    localStorage.setItem('busayoStats', JSON.stringify(stats));
}

function engineMove() {
    var moves = game.moves();
    if (moves.length === 0) return;
    game.move(moves[Math.floor(Math.random() * moves.length)]);
    board.position(game.fen());
}

function onSquareClick(square) {
    if (game.turn() === 'b') return;
    if (sourceSquare === null) {
        let piece = game.get(square);
        if (piece && piece.color === 'w') {
            sourceSquare = square;
            $('.square-' + square).css('background-color', '#a8e6cf');
        }
    } else {
        var move = game.move({ from: sourceSquare, to: square, promotion: 'q' });
        if (move) {
            if (move.san.includes('O-O')) stats.castle = true;
            if (move.captured) stats.capture = true;
            if (['e4','d4','e5','d5'].includes(move.to)) stats.center = true;
            updateTrophies();
            board.position(game.fen());
            setTimeout(engineMove, 600);
        }
        sourceSquare = null;
        board.position(game.fen());
    }
}

function evaluatePerformance() {
    let score = Math.floor(Math.random() * 21) + 75;
    if (score > stats.high) stats.high = score;
    updateTrophies();
    alert("Tutor Busayo's Grade: " + score + "%");
}

function undoMove() { game.undo(); game.undo(); board.position(game.fen()); }

// Initialize board with forced piece path
board = Chessboard('myBoard', { 
    position: 'start', 
    draggable: false,
    pieceTheme: pieceTheme 
});

$(window).resize(board.resize);

$('#myBoard').on('click', '.square-55d63', function() { 
    onSquareClick($(this).attr('data-square')); 
});

updateTrophies();
</script>
</body>
</html>
