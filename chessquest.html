<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutor Busayo's Academy</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    
    <style>
        body { background-color: #4a0404; color: #ffd700; font-family: 'Georgia', serif; display: flex; flex-direction: column; align-items: center; padding: 5px; margin: 0; min-height: 100vh; }
        h2 { margin: 15px 0; color: #ffd700; text-shadow: 2px 2px 4px #000; text-align: center; }
        .white-1e1d7 { background-color: #ffffff !important; } 
        .black-3c85d { background-color: #4ca154 !important; } 
        .highlight-white, .highlight-black { box-shadow: none !important; background-color: transparent !important; }
        #myBoard { width: 95vw !important; max-width: 450px; border: 6px solid #ffd700; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .ui-panel { width: 95%; max-width: 450px; background: #ffd700; color: #4a0404; border: 2px solid #ffffff; padding: 15px; border-radius: 8px; box-sizing: border-box; margin-top: 10px; }
        .tutor-bubble { background: #4a0404; color: #ffd700; padding: 12px; border-radius: 6px; font-weight: bold; border-left: 5px solid #ffffff; min-height: 60px; line-height: 1.4; display: flex; align-items: center; }
        .controls { display: flex; width: 95%; max-width: 450px; gap: 8px; margin: 10px 0; }
        button { flex: 1; background: #ffd700; border: 2px solid #ffffff; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 6px; color: #4a0404; }
    </style>
</head>
<body>

    <h2>Tutor Busayo's Royal Academy</h2>
    <div id="myBoard"></div>
    <div class="controls">
        <button onclick="undoMove()">Undo Move</button>
        <button onclick="location.reload()" style="background: #ffffff;">Reset Board</button>
    </div>
    <div class="ui-panel">
        <div id="tutor-comment" class="tutor-bubble">"Develop your pieces, student. Don't be lazy with your army."</div>
    </div>

<script>
var board = null;
var game = new Chess();
var sourceSquare = null;

const REMARKS = {
    opening: ["The opening is about harmony, not just moving pieces.", "Don't move the same piece twice in the opening.", "A Knight on the rim is dim. Keep them central!", "Control the center, control the world.", "Development is a race. Are you winning it?"],
    tactical: ["Tactics is knowing what to do when there is something to do.", "Every move creates a weakness. Find mine.", "Before you move, look at what my piece is now doing.", "A pin is mightier than a sword.", "Always check, it might be mate!"],
    safety: ["Is your King safe, or just lucky?", "A castle-less King is a target in the woods.", "You ignored my threat. That is a dangerous habit.", "Protect your warriors, and they will protect you.", "Patience is the greatest weapon in chess."],
    general: ["Chess is mental torture, but beautiful.", "Even a Grandmaster was once a beginner.", "The board is a mirror of your mind.", "Play the board, not the person.", "Respect the board, and the board will respect you."]
};

const PIECE_VALUES = { p: 10, n: 30, b: 35, r: 50, q: 90, k: 900 };

function removeHighlights() {
    $('#myBoard .square-55d63').css('box-shadow', 'none').css('background-color', '');
}

function evaluateBoard(current_game) {
    let totalEvaluation = 0;
    const board = current_game.board();
    const moveHistory = current_game.history({ verbose: true });
    const moveCount = Math.floor(moveHistory.length / 2);

    for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
            let piece = board[i][j];
            if (piece) {
                let val = PIECE_VALUES[piece.type];
                totalEvaluation += (piece.color === 'w' ? val : -val);
            }
        }
    }
    return totalEvaluation;
}

function getBestMove() {
    let moves = game.moves({ verbose: true });
    let bestMove = null;
    let bestValue = 9999; 
    let moveCount = Math.floor(game.history().length / 2);

    // Track which Black pieces have already moved
    let movedBlackPieces = new Set();
    game.history({ verbose: true }).forEach(m => {
        if (m.color === 'b') movedBlackPieces.add(m.from);
    });

    for (let move of moves) {
        game.move(move);
        
        let replies = game.moves();
        let worstReply = -9999;
        
        for (let reply of replies) {
            game.move(reply);
            let val = evaluateBoard(game);
            
            // AI RESTRAINT: Penalty for moving the same piece twice before Move 6
            if (moveCount < 6 && movedBlackPieces.has(move.from) && !move.captured) {
                val += 25; // Massive penalty (lower is better for AI)
            }
            
            if (val > worstReply) worstReply = val;
            game.undo();
        }
        game.undo();
        
        if (worstReply < bestValue) {
            bestValue = worstReply;
            bestMove = move;
        }
    }
    return bestMove;
}

function makeMove() {
    removeHighlights();
    let moveObj = getBestMove();
    if (!moveObj) return;
    
    game.move(moveObj);
    board.position(game.fen());
    
    let moveCount = Math.floor(game.history().length / 2);
    let category = moveCount < 8 ? "opening" : (moveObj.captured ? "tactical" : "general");
    let remark = REMARKS[category][Math.floor(Math.random() * REMARKS[category].length)];
    
    $('#tutor-comment').text('"' + remark + '"');
}

function onSquareClick(square) {
    if (game.turn() === 'b') return;
    if (sourceSquare === null) {
        let piece = game.get(square);
        if (piece && piece.color === 'w') {
            sourceSquare = square;
            removeHighlights();
            $('.square-' + square).css('box-shadow', 'inset 0 0 10px 5px #4a0404');
        }
    } else {
        var move = game.move({ from: sourceSquare, to: square, promotion: 'q' });
        if (move) {
            board.position(game.fen());
            sourceSquare = null;
            removeHighlights();
            setTimeout(makeMove, 500);
        } else {
            sourceSquare = null;
            removeHighlights();
            board.position(game.fen());
        }
    }
}

function undoMove() { game.undo(); game.undo(); board.position(game.fen()); removeHighlights(); }
function pieceTheme(piece) { return 'https://chessboardjs.com/img/chesspieces/wikipedia/' + piece + '.png'; }

board = Chessboard('myBoard', { position: 'start', draggable: false, pieceTheme: pieceTheme });
$(window).resize(board.resize);
$('#myBoard').on('click', '.square-55d63', function() { onSquareClick($(this).attr('data-square')); });
</script>
</body>
</html>
