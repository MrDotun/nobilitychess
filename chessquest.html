<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play against Tutor Busayo</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            overflow: hidden; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            /* Theme: Wine Background */
            background-color: #4c0519;
        }
        #game-container {
            width: 90vmin; 
            max-width: 600px;
            text-align: center;
        }
        #board { width: 100%; margin-bottom: 10px; border: 4px solid #facc15; border-radius: 4px; box-shadow: 0 0 20px rgba(250, 204, 21, 0.2); }
        .info-panel {
            /* Theme: Deep Wine and Yellow accents */
            background: #701a28; padding: 15px;
            border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 2px solid #facc15;
            color: white;
        }
        h2 { margin: 0 0 10px 0; color: #facc15; text-transform: uppercase; letter-spacing: 1px; }
        .grade { font-size: 1.5em; font-weight: bold; color: #facc15; }
        
        /* Highlight square on click */
        .highlight-white { background-color: #f6f669 !important; }
        .highlight-black { background-color: #e6e600 !important; }

        /* Board Square Colors (UNCHANGED) */
        .white-1e1d7 { background-color: #ebecd0 !important; }
        .black-3c85d { background-color: #779556 !important; }
        
        /* Remark Styling */
        #remark { font-style: italic; color: #facc15; min-height: 1.2em; display: block; margin-bottom: 5px; font-weight: 500; }
        #status { color: #fef08a; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="info-panel">
        <h2>Playing against: <strong>Tutor Busayo</strong></h2>
        <div id="board"></div>
        <p id="remark">"Show me your best moves!"</p>
        <p>Your Grade: <span id="grade" class="grade">Beginner</span></p>
        <p id="status">Your turn! Click a piece to select it.</p>
    </div>
</div>

<script>
    var board = null;
    var game = new Chess();
    var $status = $('#status');
    var $grade = $('#grade');
    var $remark = $('#remark');
    var sourceSquare = null; 

    var pieceValues = { 'p': 10, 'n': 30, 'b': 30, 'r': 50, 'q': 90, 'k': 0 };
    var totalScore = 0;

    function updateGrade() {
        if (totalScore >= 200) $grade.text("Grandmaster! ðŸ‘‘");
        else if (totalScore >= 120) $grade.text("Expert ðŸ†");
        else if (totalScore >= 70) $grade.text("Pro ðŸŒŸ");
        else if (totalScore >= 30) $grade.text("Advanced ðŸ‘");
        else $grade.text("Beginner");
    }

    function akingRemarks(type) {
        var remarks = {
            illegal: "That's not a legal move in my kingdom!",
            bad: ["Are you sure about that?", "My Knights are laughing at that move.", "You might need more practice!"],
            good: ["Impressive strategy!", "A move fit for a King!", "You're getting stronger!"],
            win: "CHECKMATE! You have defeated Tutor Busayo! Congratulations, Champion! ðŸ†",
            lose: "CHECKMATE! Better luck next time. Tutor Busayo remains undefeated!"
        };

        if (type === 'illegal') {
            $remark.text(remarks.illegal);
        } else if (type === 'good') {
            $remark.text(remarks.good[Math.floor(Math.random() * remarks.good.length)]);
        } else if (type === 'bad') {
            $remark.text(remarks.bad[Math.floor(Math.random() * remarks.bad.length)]);
        } else if (type === 'win') {
            $remark.text(remarks.win);
            $status.text("Victory is yours!");
        } else if (type === 'lose') {
            $remark.text(remarks.lose);
            $status.text("Game Over.");
        }
    }

    function makeAIMove() {
        if (game.game_over()) {
            checkGameOver();
            return;
        }

        var moves = game.moves({ verbose: true });
        
        var threatenedSquares = [];
        var fen = game.fen();
        var tempGame = new Chess(fen);
        var tokens = fen.split(' ');
        tokens[1] = tokens[1] === 'w' ? 'b' : 'w'; 
        tempGame.load(tokens.join(' '));
        tempGame.moves({ verbose: true }).forEach(function(m) {
            if (m.captured) threatenedSquares.push(m.to);
        });

        var scoredMoves = moves.map(function(move) {
            var score = Math.random() * 5; 
            if (move.san.includes('#')) return { move: move, score: 10000 };
            
            if (threatenedSquares.includes(move.from)) {
                var val = pieceValues[move.piece] || 10;
                score += val * 15;
            }
            if (move.captured) score += pieceValues[move.captured] * 20;

            game.move(move);
            var opponentMoves = game.moves({ verbose: true });
            if (opponentMoves.find(function(m) { return m.to === move.to; })) {
                var val = pieceValues[move.piece] || 10;
                score -= (val * 25);
            }
            game.undo();
            return { move: move, score: score };
        });

        scoredMoves.sort(function(a, b) { return b.score - a.score; });
        game.move(scoredMoves[0].move);
        
        board.position(game.fen());
        
        if (game.game_over()) {
            checkGameOver();
        } else {
            $status.text("Tutor Busayo moved. Your turn!");
        }
    }

    function checkGameOver() {
        if (game.in_checkmate()) {
            if (game.turn() === 'b') { // If it's black's turn to move and they are in mate, white (player) won
                akingRemarks('win');
            } else {
                akingRemarks('lose');
            }
        } else if (game.in_draw()) {
            $status.text("Game Over - It's a Draw!");
            $remark.text("A hard-fought stalemate!");
        } else {
            $status.text("Game Over!");
        }
    }

    function onSquareClick(square) {
        if (game.game_over()) return;

        if (sourceSquare === null) {
            var piece = game.get(square);
            if (piece && piece.color === 'w') {
                sourceSquare = square;
                removeHighlights();
                addHighlight(square);
                $status.text("Piece selected. Click where to move.");
            }
            return;
        }

        var move = game.move({
            from: sourceSquare,
            to: square,
            promotion: 'q'
        });

        if (move === null) {
            var piece = game.get(square);
            if (piece && piece.color === 'w') {
                sourceSquare = square;
                removeHighlights();
                addHighlight(square);
            } else {
                sourceSquare = null;
                removeHighlights();
                $status.text("Invalid move.");
                akingRemarks('illegal');
            }
            return;
        }

        board.position(game.fen());
        sourceSquare = null;
        removeHighlights();

        if (move.captured) {
            totalScore += pieceValues[move.captured];
            updateGrade();
            akingRemarks('good');
        } else {
            if(Math.random() > 0.7) akingRemarks('bad');
        }

        if (game.game_over()) {
            checkGameOver();
        } else {
            $status.text("Nice move! Tutor Busayo is thinking...");
            window.setTimeout(makeAIMove, 500);
        }
    }

    function addHighlight(square) {
        var $el = $('#board .square-' + square);
        if ($el.hasClass('black-3c85d')) $el.addClass('highlight-black');
        else $el.addClass('highlight-white');
    }

    function removeHighlights() {
        $('#board [class*="square-"]').removeClass('highlight-white highlight-black');
    }

    var config = {
        draggable: false,
        position: 'start',
        pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    };
    
    board = ChessBoard('board', config);

    $('#board').on('click', '[class*="square-"]', function() {
        var square = $(this).attr('data-square');
        onSquareClick(square);
    });

    $(window).resize(board.resize);
</script>
</body>
</html>
